<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.4" />
<title>main API documentation</title>
<meta name="description" content="Restart.us Main Module …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>main</code></h1>
</header>
<section id="section-intro">
<p>Restart.us Main Module.</p>
<p>Eventually this will become a class and we will
keep the constants like names as private class variables</p>
<p><a href="https://stackoverflow.com/questions/20309456/call-a-function-from-another-file-in-python">https://stackoverflow.com/questions/20309456/call-a-function-from-another-file-in-python</a></p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Restart.us Main Module.

Eventually this will become a class and we will
keep the constants like names as private class variables

https://stackoverflow.com/questions/20309456/call-a-function-from-another-file-in-python

&#34;&#34;&#34;

# https://stackoverflow.com/questions/47561840/python-how-can-i-separate-functions-of-class-into-multiple-files
# explains that you can split a class into separate files by
# putting these inside the class definition
# http://effbot.org/pyfaq/how-do-i-share-global-variables-across-modules.htm
# Before we move to full modules, just import locally
# https://inventwithpython.com/blog/2012/04/06/stop-using-print-for-debugging-a-5-minute-quickstart-guide-to-pythons-logging-module/
import logging  # noqa:F401
import argparse

# name collision https://docs.python.org/3/library/resource.html
# so can&#39;t use resource.py
from util import Log
from pathlib import Path

# from config import Config
from loader.load_yaml import LoadYAML
from model import Model
from resourcemodel import Resource

# from population import Population
from economy import Economy
from disease import Disease
from behavioral import Behavioral
from activity import Activity
from base import Base
from dashboard import Dashboard
from typing import Optional
from pop.population_dict import PopulationDict
from consumption import Consumption
from filtermodel import Filter


# This is the only way to get it to work needs to be in main
# https://www.programcreek.com/python/example/192/logging.Formatter
# the confit now seems to work


class Compose:
    &#34;&#34;&#34;Compose an entire model together.

    Note this must be rentrant for streamlit to work
    So it detects if it has been called again
    &#34;&#34;&#34;

    def __init__(self):
        &#34;&#34;&#34;Bootstrap the whole model creating all objects.

        Bootstrap where each modules successively knows more about the world
        Population defines Pop_details[p,d], Pop_levels[p,l]

        In this version, there is a specific order of creation and implicit
        dependencies so use in this order. The notation we uses suffixes each
        with a unique letter that gives the number of elements so n x a means n
        resource by a attributes. And yes this will not work when we have more
        than 26 types of dimensions :-)

        In a future revision, you can do this in any order and it will work
        - model itself
        - resource which creates the n resources (eg N95, test kit, etc.) with
          the columns being x attributes like the units and space R[n, x].
        - consumption to create burn rates for each &#34;level&#34; of the model.
          Instead of calculating unique burn rates per population element, we
          bucketize with the consumption level l so it returns C[l, n]

        TODO: Note that then when running streamlit this will be run multiple
        times and must be reentrant which is not today, the logging does not
        work

        And if you make a change to any, the model will automatically recalc
        everything
        &#34;&#34;&#34;
        # set up the logging
        # This name should *not* be the same as any module name like main
        name = &#34;test&#34;
        # this should only get run once so check here
        # breakpoint()
        log_root = Log(name)
        # Set all the loggers the same
        log = log_root.log
        # test that logging works
        log_root.test(log)
        # removin this line was the problem but it is back in util.py
        # log.setLevel(logging.DEBUG)

        # do not need this with log_root
        # log = set_logger(__name__, level=logging.DEBUG)
        # log = logging.getLogger(__name__)

        #  https://docs.python.org/3/howto/logging-cookbook.html
        log.debug(f&#34;{__name__=}&#34;)
        log.info(&#34;hello world&#34;)

        parser = self.get_parser()
        args = parser.parse_args()
        log.debug(f&#34;{args=}&#34;)
        if args.load == &#34;yaml&#34;:
            loaded = LoadYAML(args.input, log_root=log_root)
            if not loaded.data:
                raise ValueError(&#34;f{args.input=} is empty&#34;)
            log.debug(f&#34;{loaded.data=}&#34;)
        else:
            raise ValueError(&#34;not implemented&#34;)

        # refactor with method chaining but this does require a single class
        # and a set of decorators
        self.model = model = (
            Model(name, log_root=log_root)
            .set_configure(loaded)
            .set_population(type=args.population)
            # .set_population(type=args.students)
            .set_resource(type=args.resource)
            # .set_resource(type=args.pharma)
            .set_filter(type=args.filter)
            .set_consumption(type=args.consumption)
            .set_economy(type=args.economy)
            .set_disease(type=args.disease)
            .set_activity(type=args.activity)
            .set_behavioral(type=args.behavioral)
        )
        # run the loader and put everything into a super dictionary
        # To change the model, just replace LoadYAML and the configuration
        # of it which starts off the entire model
        self.model1 = self.old_compose(&#34;old_&#34; + name, log_root=log_root)
        log.debug(f&#34;{self.model1=}&#34;)

        # http://net-informations.com/python/iq/instance.htm
        log.debug(f&#34;{model} is {vars(model)}&#34;)
        for name, value in vars(model).items():
            # http://effbot.org/pyfaq/how-do-i-check-if-an-object-is-an-instance-of-a-given-class-or-of-a-subclass-of-it.htm
            # if issubclass(value, Base):
            if isinstance(value, Base):
                log.debug(f&#34;object {name} holds {value} subclass of Base&#34;)

        # model.resource.set_stockpile(model.population.level_total_demand_ln_df)
        # log.debug(&#34;Safety stock\n%s&#34;, model.resource.safety_stock_ln_df)

        # create the resource object that is p populations and n items
        log.debug(&#34;resource attributes\n%s&#34;, model.resource.attr_na_df)

        # This is a population p by d dimension, eventually the second column
        # should be a call back that calculates consumption based
        # Eventually, this will be multi dimenstional, so in addition to the
        # total but there will also be the number of COVID patients And other
        # tempo data like number of runs so eventually this is d dimensinoal
        log.debug(&#34;Population\n%s&#34;, model.population.attr_pd_df)

        # Now bucket population into a set of levels
        # So we have a table is p x l
        log.debug(&#34;Population by level\n%s&#34;, model.consumption.level_pl_df)

        # This is rows that are levels adn then usage of each resource  or l, n
        # When population become n x d, then there will be a usage
        # level for each do, so this become d x p x n
        log.debug(f&#34;{model.consumption.level_demand_ln_df=}&#34;)

        # p x l * l x n -&gt; p x n
        log.debug(f&#34;{model.consumption.demand_pn_df=}&#34;)

        # Now it get&#39;s easier, this is the per unit value, so multiply by the
        # population and the * with values does an element wise multiplication
        # With different tempos, this will be across all d dimensions

        log.debug(f&#34;{model.consumption.total_demand_pn_df=}&#34;)
        log.debug(f&#34;{model.consumption.level_pl_df=}&#34;)

        log.debug(f&#34;{model.resource.cost_ln_df=}&#34;)

        model.consumption.level_total_cost(model.resource.cost_ln_df)
        log.debug(f&#34;{model.consumption.level_total_cost_ln_df=}&#34;)

        # test iteration
        for base_key, base_value in model:
            log.debug(f&#34;{base_key=}&#34;)
            log.debug(f&#34;{base_value=}&#34;)
            for df_key, df_value in base_value:
                log.debug(f&#34;{df_key=}&#34;)
                log.debug(f&#34;{df_value=}&#34;)

        for s in [3, 6, 9]:
            log.info(f&#34;changing stockpile to {s=}&#34;)
            model.resource.set_stockpile_days(s)
            log.debug(f&#34;{model.resource.safety_stock_ln_df=}&#34;)
            log.info(f&#34;{model.resource.inventory_ln_df=}&#34;)

        # run with streamlit run and then this will not return until after
        # when run as just regular python this doesn&#39;t do anything
        log.info(&#34;start dashboard &#34;)
        log.debug(&#34;start dashboard&#34;)

    def get_parser(self):
        &#34;&#34;&#34;Set Parser arguments.

        For all the choices, returns an argparser object
        &#34;&#34;&#34;
        # TODO: Convert to using confuse to store parameters
        # https://github.com/beetbox/confuse
        # expect a real file
        # https://docs.python.org/3/library/argparse.html
        parser = argparse.ArgumentParser()
        parser.add_argument(
            &#34;-l&#34;,
            &#34;--load&#34;,
            choices=[&#34;yaml&#34;, &#34;csv&#34;],
            default=&#34;yaml&#34;,
            help=&#34;Select loader&#34;,
        )
        parser.add_argument(
            &#34;-p&#34;,
            &#34;--population&#34;,
            choices=[&#34;dict&#34;, &#34;oes&#34;],
            help=&#34;Select population data cube&#34;,
        )
        parser.add_argument(
            &#34;-r&#34;,
            &#34;--resource&#34;,
            choices=[&#34;eoc&#34;, &#34;chelsea&#34;],
            default=&#34;eoc&#34;,
            help=&#34;Select Resource model&#34;,
        )
        parser.add_argument(
            &#34;-f&#34;,
            &#34;--filter&#34;,
            choices=[&#34;eoc&#34;, &#34;chelsea&#34;],
            default={&#34;County&#34;: None, &#34;State&#34;: &#34;California&#34;},
            help=&#34;Select filters model&#34;,
        )
        parser.add_argument(
            &#34;-c&#34;,
            &#34;--consumption&#34;,
            choices=[&#34;wa-doh&#34;, &#34;ensemble&#34;],
            default=&#34;wa-doh&#34;,
            help=&#34;Select Resource model&#34;,
        )
        parser.add_argument(
            &#34;-e&#34;,
            &#34;--economy&#34;,
            choices=[&#34;ml&#34;, &#34;ensemble&#34;],
            default=&#34;ml&#34;,
            help=&#34;Select Econometric model&#34;,
        )
        parser.add_argument(
            &#34;-b&#34;,
            &#34;--behavioral&#34;,
            choices=[&#34;apple&#34;, &#34;google&#34;, &#34;ensemble&#34;],
            default=&#34;ensemble&#34;,
            help=&#34;Select Econometric model&#34;,
        )

        parser.add_argument(
            &#34;-m&#34;,
            &#34;--activity&#34;,
            choices=[&#34;apple&#34;, &#34;ensemble&#34;, &#34;google&#34;],
            default=&#34;ensemble&#34;,
            help=&#34;Select Activity Model&#34;,
        )

        parser.add_argument(
            &#34;-d&#34;,
            &#34;--disease&#34;,
            choices=[&#34;imhe&#34;, &#34;ensemble&#34;, &#34;jhu&#34;],
            default=&#34;imhe&#34;,
            help=&#34;Select Epidemological Disease Model&#34;,
        )

        # https://treyhunner.com/2018/12/why-you-should-be-using-pathlib/
        parser.add_argument(
            &#34;input&#34;,
            nargs=&#34;?&#34;,  # one argument
            type=Path,
            default=Path(&#34;washington&#34;).absolute(),
        )
        return parser

    def old_compose(self, name, log_root: Optional[Log] = None):
        &#34;&#34;&#34;Old Model invocation.

        Old Model composition in parts not using chaining
        &#34;&#34;&#34;
        # https://www.tutorialspoint.com/Explain-Python-class-method-chaining
        if log_root is not None:
            log = log_root.log
        else:
            log = logging.getLogger(__name__)

        log.info(&#34;creating Model&#34;)
        model: Model = Model(name, log_root=log_root)
        # run the loader and put everything into a super dictionary
        # To change the model, just replace LoadYAML and the configuration
        # of it which starts off the entire model
        loaded = LoadYAML(Path(&#34;washington&#34;).absolute(), log_root=log_root,)
        log.debug(f&#34;{loaded.data=}&#34;)
        log.info(&#34;configure Model&#34;)
        model.set_configure(loaded)
        # note we cannot just past model down to allow chaining to work
        log.info(&#34;creating Population&#34;)
        model.population = PopulationDict(
            model.data,
            model.label,
            index=&#34;Population p&#34;,
            columns=&#34;Pop Detail d&#34;,
            log_root=log_root,
        )
        log.debug(&#34;creating Resource&#34;)
        model.resource = Resource(model.data, log_root=model.log_root)
        log.debug(&#34;creating Consumption&#34;)
        model.consumption = Consumption(model.data, log_root=model.log_root)
        log.debug(&#34;creating Filter&#34;)
        model.filter = Filter(model.data, log_root=model.log_root)
        log.debug(&#34;creating Economy&#34;)
        model.economy = Economy(model.data, log_root=model.log_root)
        log.debug(&#34;creating Disease&#34;)
        model.disease = Disease(model.data, log_root=model.log_root)
        log.debug(&#34;creating Activity&#34;)
        model.activity = Activity(model.data, log_root=model.log_root)
        log.debug(&#34;creating Behavioral&#34;)
        model.behavioral = Behavioral(model.data, log_root=model.log_root)
        log.debug(f&#34;{model=}&#34;)


# This is a global variable so easy to find
# this does not work, streamlit just runs the whole things all over again for
# each page
# compose: Optional[Compose] = None

if __name__ == &#34;__main__&#34;:
    # compose the entire model runs as a class so it is rentrant
    compose = Compose()
    Dashboard(compose.model)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="main.Compose"><code class="flex name class">
<span>class <span class="ident">Compose</span></span>
</code></dt>
<dd>
<div class="desc"><p>Compose an entire model together.</p>
<p>Note this must be rentrant for streamlit to work
So it detects if it has been called again</p>
<p>Bootstrap the whole model creating all objects.</p>
<p>Bootstrap where each modules successively knows more about the world
Population defines Pop_details[p,d], Pop_levels[p,l]</p>
<p>In this version, there is a specific order of creation and implicit
dependencies so use in this order. The notation we uses suffixes each
with a unique letter that gives the number of elements so n x a means n
resource by a attributes. And yes this will not work when we have more
than 26 types of dimensions :-)</p>
<p>In a future revision, you can do this in any order and it will work
- model itself
- resource which creates the n resources (eg N95, test kit, etc.) with
the columns being x attributes like the units and space R[n, x].
- consumption to create burn rates for each "level" of the model.
Instead of calculating unique burn rates per population element, we
bucketize with the consumption level l so it returns C[l, n]</p>
<p>TODO: Note that then when running streamlit this will be run multiple
times and must be reentrant which is not today, the logging does not
work</p>
<p>And if you make a change to any, the model will automatically recalc
everything</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Compose:
    &#34;&#34;&#34;Compose an entire model together.

    Note this must be rentrant for streamlit to work
    So it detects if it has been called again
    &#34;&#34;&#34;

    def __init__(self):
        &#34;&#34;&#34;Bootstrap the whole model creating all objects.

        Bootstrap where each modules successively knows more about the world
        Population defines Pop_details[p,d], Pop_levels[p,l]

        In this version, there is a specific order of creation and implicit
        dependencies so use in this order. The notation we uses suffixes each
        with a unique letter that gives the number of elements so n x a means n
        resource by a attributes. And yes this will not work when we have more
        than 26 types of dimensions :-)

        In a future revision, you can do this in any order and it will work
        - model itself
        - resource which creates the n resources (eg N95, test kit, etc.) with
          the columns being x attributes like the units and space R[n, x].
        - consumption to create burn rates for each &#34;level&#34; of the model.
          Instead of calculating unique burn rates per population element, we
          bucketize with the consumption level l so it returns C[l, n]

        TODO: Note that then when running streamlit this will be run multiple
        times and must be reentrant which is not today, the logging does not
        work

        And if you make a change to any, the model will automatically recalc
        everything
        &#34;&#34;&#34;
        # set up the logging
        # This name should *not* be the same as any module name like main
        name = &#34;test&#34;
        # this should only get run once so check here
        # breakpoint()
        log_root = Log(name)
        # Set all the loggers the same
        log = log_root.log
        # test that logging works
        log_root.test(log)
        # removin this line was the problem but it is back in util.py
        # log.setLevel(logging.DEBUG)

        # do not need this with log_root
        # log = set_logger(__name__, level=logging.DEBUG)
        # log = logging.getLogger(__name__)

        #  https://docs.python.org/3/howto/logging-cookbook.html
        log.debug(f&#34;{__name__=}&#34;)
        log.info(&#34;hello world&#34;)

        parser = self.get_parser()
        args = parser.parse_args()
        log.debug(f&#34;{args=}&#34;)
        if args.load == &#34;yaml&#34;:
            loaded = LoadYAML(args.input, log_root=log_root)
            if not loaded.data:
                raise ValueError(&#34;f{args.input=} is empty&#34;)
            log.debug(f&#34;{loaded.data=}&#34;)
        else:
            raise ValueError(&#34;not implemented&#34;)

        # refactor with method chaining but this does require a single class
        # and a set of decorators
        self.model = model = (
            Model(name, log_root=log_root)
            .set_configure(loaded)
            .set_population(type=args.population)
            # .set_population(type=args.students)
            .set_resource(type=args.resource)
            # .set_resource(type=args.pharma)
            .set_filter(type=args.filter)
            .set_consumption(type=args.consumption)
            .set_economy(type=args.economy)
            .set_disease(type=args.disease)
            .set_activity(type=args.activity)
            .set_behavioral(type=args.behavioral)
        )
        # run the loader and put everything into a super dictionary
        # To change the model, just replace LoadYAML and the configuration
        # of it which starts off the entire model
        self.model1 = self.old_compose(&#34;old_&#34; + name, log_root=log_root)
        log.debug(f&#34;{self.model1=}&#34;)

        # http://net-informations.com/python/iq/instance.htm
        log.debug(f&#34;{model} is {vars(model)}&#34;)
        for name, value in vars(model).items():
            # http://effbot.org/pyfaq/how-do-i-check-if-an-object-is-an-instance-of-a-given-class-or-of-a-subclass-of-it.htm
            # if issubclass(value, Base):
            if isinstance(value, Base):
                log.debug(f&#34;object {name} holds {value} subclass of Base&#34;)

        # model.resource.set_stockpile(model.population.level_total_demand_ln_df)
        # log.debug(&#34;Safety stock\n%s&#34;, model.resource.safety_stock_ln_df)

        # create the resource object that is p populations and n items
        log.debug(&#34;resource attributes\n%s&#34;, model.resource.attr_na_df)

        # This is a population p by d dimension, eventually the second column
        # should be a call back that calculates consumption based
        # Eventually, this will be multi dimenstional, so in addition to the
        # total but there will also be the number of COVID patients And other
        # tempo data like number of runs so eventually this is d dimensinoal
        log.debug(&#34;Population\n%s&#34;, model.population.attr_pd_df)

        # Now bucket population into a set of levels
        # So we have a table is p x l
        log.debug(&#34;Population by level\n%s&#34;, model.consumption.level_pl_df)

        # This is rows that are levels adn then usage of each resource  or l, n
        # When population become n x d, then there will be a usage
        # level for each do, so this become d x p x n
        log.debug(f&#34;{model.consumption.level_demand_ln_df=}&#34;)

        # p x l * l x n -&gt; p x n
        log.debug(f&#34;{model.consumption.demand_pn_df=}&#34;)

        # Now it get&#39;s easier, this is the per unit value, so multiply by the
        # population and the * with values does an element wise multiplication
        # With different tempos, this will be across all d dimensions

        log.debug(f&#34;{model.consumption.total_demand_pn_df=}&#34;)
        log.debug(f&#34;{model.consumption.level_pl_df=}&#34;)

        log.debug(f&#34;{model.resource.cost_ln_df=}&#34;)

        model.consumption.level_total_cost(model.resource.cost_ln_df)
        log.debug(f&#34;{model.consumption.level_total_cost_ln_df=}&#34;)

        # test iteration
        for base_key, base_value in model:
            log.debug(f&#34;{base_key=}&#34;)
            log.debug(f&#34;{base_value=}&#34;)
            for df_key, df_value in base_value:
                log.debug(f&#34;{df_key=}&#34;)
                log.debug(f&#34;{df_value=}&#34;)

        for s in [3, 6, 9]:
            log.info(f&#34;changing stockpile to {s=}&#34;)
            model.resource.set_stockpile_days(s)
            log.debug(f&#34;{model.resource.safety_stock_ln_df=}&#34;)
            log.info(f&#34;{model.resource.inventory_ln_df=}&#34;)

        # run with streamlit run and then this will not return until after
        # when run as just regular python this doesn&#39;t do anything
        log.info(&#34;start dashboard &#34;)
        log.debug(&#34;start dashboard&#34;)

    def get_parser(self):
        &#34;&#34;&#34;Set Parser arguments.

        For all the choices, returns an argparser object
        &#34;&#34;&#34;
        # TODO: Convert to using confuse to store parameters
        # https://github.com/beetbox/confuse
        # expect a real file
        # https://docs.python.org/3/library/argparse.html
        parser = argparse.ArgumentParser()
        parser.add_argument(
            &#34;-l&#34;,
            &#34;--load&#34;,
            choices=[&#34;yaml&#34;, &#34;csv&#34;],
            default=&#34;yaml&#34;,
            help=&#34;Select loader&#34;,
        )
        parser.add_argument(
            &#34;-p&#34;,
            &#34;--population&#34;,
            choices=[&#34;dict&#34;, &#34;oes&#34;],
            help=&#34;Select population data cube&#34;,
        )
        parser.add_argument(
            &#34;-r&#34;,
            &#34;--resource&#34;,
            choices=[&#34;eoc&#34;, &#34;chelsea&#34;],
            default=&#34;eoc&#34;,
            help=&#34;Select Resource model&#34;,
        )
        parser.add_argument(
            &#34;-f&#34;,
            &#34;--filter&#34;,
            choices=[&#34;eoc&#34;, &#34;chelsea&#34;],
            default={&#34;County&#34;: None, &#34;State&#34;: &#34;California&#34;},
            help=&#34;Select filters model&#34;,
        )
        parser.add_argument(
            &#34;-c&#34;,
            &#34;--consumption&#34;,
            choices=[&#34;wa-doh&#34;, &#34;ensemble&#34;],
            default=&#34;wa-doh&#34;,
            help=&#34;Select Resource model&#34;,
        )
        parser.add_argument(
            &#34;-e&#34;,
            &#34;--economy&#34;,
            choices=[&#34;ml&#34;, &#34;ensemble&#34;],
            default=&#34;ml&#34;,
            help=&#34;Select Econometric model&#34;,
        )
        parser.add_argument(
            &#34;-b&#34;,
            &#34;--behavioral&#34;,
            choices=[&#34;apple&#34;, &#34;google&#34;, &#34;ensemble&#34;],
            default=&#34;ensemble&#34;,
            help=&#34;Select Econometric model&#34;,
        )

        parser.add_argument(
            &#34;-m&#34;,
            &#34;--activity&#34;,
            choices=[&#34;apple&#34;, &#34;ensemble&#34;, &#34;google&#34;],
            default=&#34;ensemble&#34;,
            help=&#34;Select Activity Model&#34;,
        )

        parser.add_argument(
            &#34;-d&#34;,
            &#34;--disease&#34;,
            choices=[&#34;imhe&#34;, &#34;ensemble&#34;, &#34;jhu&#34;],
            default=&#34;imhe&#34;,
            help=&#34;Select Epidemological Disease Model&#34;,
        )

        # https://treyhunner.com/2018/12/why-you-should-be-using-pathlib/
        parser.add_argument(
            &#34;input&#34;,
            nargs=&#34;?&#34;,  # one argument
            type=Path,
            default=Path(&#34;washington&#34;).absolute(),
        )
        return parser

    def old_compose(self, name, log_root: Optional[Log] = None):
        &#34;&#34;&#34;Old Model invocation.

        Old Model composition in parts not using chaining
        &#34;&#34;&#34;
        # https://www.tutorialspoint.com/Explain-Python-class-method-chaining
        if log_root is not None:
            log = log_root.log
        else:
            log = logging.getLogger(__name__)

        log.info(&#34;creating Model&#34;)
        model: Model = Model(name, log_root=log_root)
        # run the loader and put everything into a super dictionary
        # To change the model, just replace LoadYAML and the configuration
        # of it which starts off the entire model
        loaded = LoadYAML(Path(&#34;washington&#34;).absolute(), log_root=log_root,)
        log.debug(f&#34;{loaded.data=}&#34;)
        log.info(&#34;configure Model&#34;)
        model.set_configure(loaded)
        # note we cannot just past model down to allow chaining to work
        log.info(&#34;creating Population&#34;)
        model.population = PopulationDict(
            model.data,
            model.label,
            index=&#34;Population p&#34;,
            columns=&#34;Pop Detail d&#34;,
            log_root=log_root,
        )
        log.debug(&#34;creating Resource&#34;)
        model.resource = Resource(model.data, log_root=model.log_root)
        log.debug(&#34;creating Consumption&#34;)
        model.consumption = Consumption(model.data, log_root=model.log_root)
        log.debug(&#34;creating Filter&#34;)
        model.filter = Filter(model.data, log_root=model.log_root)
        log.debug(&#34;creating Economy&#34;)
        model.economy = Economy(model.data, log_root=model.log_root)
        log.debug(&#34;creating Disease&#34;)
        model.disease = Disease(model.data, log_root=model.log_root)
        log.debug(&#34;creating Activity&#34;)
        model.activity = Activity(model.data, log_root=model.log_root)
        log.debug(&#34;creating Behavioral&#34;)
        model.behavioral = Behavioral(model.data, log_root=model.log_root)
        log.debug(f&#34;{model=}&#34;)</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="main.Compose.get_parser"><code class="name flex">
<span>def <span class="ident">get_parser</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Set Parser arguments.</p>
<p>For all the choices, returns an argparser object</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_parser(self):
    &#34;&#34;&#34;Set Parser arguments.

    For all the choices, returns an argparser object
    &#34;&#34;&#34;
    # TODO: Convert to using confuse to store parameters
    # https://github.com/beetbox/confuse
    # expect a real file
    # https://docs.python.org/3/library/argparse.html
    parser = argparse.ArgumentParser()
    parser.add_argument(
        &#34;-l&#34;,
        &#34;--load&#34;,
        choices=[&#34;yaml&#34;, &#34;csv&#34;],
        default=&#34;yaml&#34;,
        help=&#34;Select loader&#34;,
    )
    parser.add_argument(
        &#34;-p&#34;,
        &#34;--population&#34;,
        choices=[&#34;dict&#34;, &#34;oes&#34;],
        help=&#34;Select population data cube&#34;,
    )
    parser.add_argument(
        &#34;-r&#34;,
        &#34;--resource&#34;,
        choices=[&#34;eoc&#34;, &#34;chelsea&#34;],
        default=&#34;eoc&#34;,
        help=&#34;Select Resource model&#34;,
    )
    parser.add_argument(
        &#34;-f&#34;,
        &#34;--filter&#34;,
        choices=[&#34;eoc&#34;, &#34;chelsea&#34;],
        default={&#34;County&#34;: None, &#34;State&#34;: &#34;California&#34;},
        help=&#34;Select filters model&#34;,
    )
    parser.add_argument(
        &#34;-c&#34;,
        &#34;--consumption&#34;,
        choices=[&#34;wa-doh&#34;, &#34;ensemble&#34;],
        default=&#34;wa-doh&#34;,
        help=&#34;Select Resource model&#34;,
    )
    parser.add_argument(
        &#34;-e&#34;,
        &#34;--economy&#34;,
        choices=[&#34;ml&#34;, &#34;ensemble&#34;],
        default=&#34;ml&#34;,
        help=&#34;Select Econometric model&#34;,
    )
    parser.add_argument(
        &#34;-b&#34;,
        &#34;--behavioral&#34;,
        choices=[&#34;apple&#34;, &#34;google&#34;, &#34;ensemble&#34;],
        default=&#34;ensemble&#34;,
        help=&#34;Select Econometric model&#34;,
    )

    parser.add_argument(
        &#34;-m&#34;,
        &#34;--activity&#34;,
        choices=[&#34;apple&#34;, &#34;ensemble&#34;, &#34;google&#34;],
        default=&#34;ensemble&#34;,
        help=&#34;Select Activity Model&#34;,
    )

    parser.add_argument(
        &#34;-d&#34;,
        &#34;--disease&#34;,
        choices=[&#34;imhe&#34;, &#34;ensemble&#34;, &#34;jhu&#34;],
        default=&#34;imhe&#34;,
        help=&#34;Select Epidemological Disease Model&#34;,
    )

    # https://treyhunner.com/2018/12/why-you-should-be-using-pathlib/
    parser.add_argument(
        &#34;input&#34;,
        nargs=&#34;?&#34;,  # one argument
        type=Path,
        default=Path(&#34;washington&#34;).absolute(),
    )
    return parser</code></pre>
</details>
</dd>
<dt id="main.Compose.old_compose"><code class="name flex">
<span>def <span class="ident">old_compose</span></span>(<span>self, name, log_root: Union[util.Log, NoneType] = None)</span>
</code></dt>
<dd>
<div class="desc"><p>Old Model invocation.</p>
<p>Old Model composition in parts not using chaining</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def old_compose(self, name, log_root: Optional[Log] = None):
    &#34;&#34;&#34;Old Model invocation.

    Old Model composition in parts not using chaining
    &#34;&#34;&#34;
    # https://www.tutorialspoint.com/Explain-Python-class-method-chaining
    if log_root is not None:
        log = log_root.log
    else:
        log = logging.getLogger(__name__)

    log.info(&#34;creating Model&#34;)
    model: Model = Model(name, log_root=log_root)
    # run the loader and put everything into a super dictionary
    # To change the model, just replace LoadYAML and the configuration
    # of it which starts off the entire model
    loaded = LoadYAML(Path(&#34;washington&#34;).absolute(), log_root=log_root,)
    log.debug(f&#34;{loaded.data=}&#34;)
    log.info(&#34;configure Model&#34;)
    model.set_configure(loaded)
    # note we cannot just past model down to allow chaining to work
    log.info(&#34;creating Population&#34;)
    model.population = PopulationDict(
        model.data,
        model.label,
        index=&#34;Population p&#34;,
        columns=&#34;Pop Detail d&#34;,
        log_root=log_root,
    )
    log.debug(&#34;creating Resource&#34;)
    model.resource = Resource(model.data, log_root=model.log_root)
    log.debug(&#34;creating Consumption&#34;)
    model.consumption = Consumption(model.data, log_root=model.log_root)
    log.debug(&#34;creating Filter&#34;)
    model.filter = Filter(model.data, log_root=model.log_root)
    log.debug(&#34;creating Economy&#34;)
    model.economy = Economy(model.data, log_root=model.log_root)
    log.debug(&#34;creating Disease&#34;)
    model.disease = Disease(model.data, log_root=model.log_root)
    log.debug(&#34;creating Activity&#34;)
    model.activity = Activity(model.data, log_root=model.log_root)
    log.debug(&#34;creating Behavioral&#34;)
    model.behavioral = Behavioral(model.data, log_root=model.log_root)
    log.debug(f&#34;{model=}&#34;)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="main.Compose" href="#main.Compose">Compose</a></code></h4>
<ul class="">
<li><code><a title="main.Compose.get_parser" href="#main.Compose.get_parser">get_parser</a></code></li>
<li><code><a title="main.Compose.old_compose" href="#main.Compose.old_compose">old_compose</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.4</a>.</p>
</footer>
</body>
</html>
